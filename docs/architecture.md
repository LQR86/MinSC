# MinSC ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## ğŸ“‹ æ¶æ„æ¦‚è§ˆ

MinSC (Minimal StarCraft for MCP) æ˜¯ä¸€ä¸ªä¸ºAI Agentè®¾è®¡çš„è½»é‡çº§RTSæ¸¸æˆå¼•æ“ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„è½¯ä»¶æ¶æ„æ¨¡å¼ã€‚

### ğŸ—ï¸ æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI Agent Layer                       â”‚
â”‚                   (Strategic/Tactical/Operational)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    MCP Interface                        â”‚
â”‚              (Model Context Protocol)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 IoC/AOP Container                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚ GameServices â”‚ ECSServices  â”‚ CoreServices â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 Cross-Cutting Concerns                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚   Logging    â”‚ Performance  â”‚ Transactions â”‚      â”‚
â”‚    â”‚   Aspect     â”‚   Aspect     â”‚    Aspect    â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 Application Layer                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚    Events    â”‚State Machine â”‚     ECS      â”‚      â”‚
â”‚    â”‚   (blinker)  â”‚(transitions) â”‚   (esper)    â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Game Engine                           â”‚
â”‚              (Pygame + Physics)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è¯¦è¿°

### 1. IoC/AOP å®¹å™¨æ¶æ„

#### **ApplicationContainer** - æ ¹å®¹å™¨
```python
class ApplicationContainer(containers.DeclarativeContainer):
    config = providers.Configuration()
    game = providers.DependenciesContainer()  # GameContainer
    ecs = providers.DependenciesContainer()   # ECSContainer
```

#### **GameContainer** - æ¸¸æˆæœåŠ¡å®¹å™¨
- **åŸºç¡€è®¾æ–½æœåŠ¡**: ConfigService, LoggingService, MetricsService
- **äº‹ä»¶æœåŠ¡**: EventBusService (blinkeré›†æˆ)
- **æ¸¸æˆæœåŠ¡**: BuildingManagerService, UnitManagerService, GameStateService
- **AIå†³ç­–æœåŠ¡**: StrategyService, TacticalService, OperationalService

#### **ECSContainer** - ECSç»„ä»¶å®¹å™¨
- **ECSæ ¸å¿ƒ**: World, ComponentManager, SystemManager
- **ç»„ä»¶å·¥å‚**: PositionComponent, HealthComponent, ResourceComponent
- **ç³»ç»ŸæœåŠ¡**: MovementSystem, ResourceSystem, RenderSystem

### 2. AOP åˆ‡é¢ç¼–ç¨‹

#### **åŸºäºaspectlib 2.0.0å®ç°**
```python
# å››å¤§æ ¸å¿ƒåˆ‡é¢
@Aspect(bind=True)
def logging_aspect(cutpoint, *args, **kwargs):
    """æ—¥å¿—è®°å½•åˆ‡é¢ - è‡ªåŠ¨è®°å½•æ–¹æ³•è°ƒç”¨"""

@Aspect(bind=True) 
def performance_aspect(cutpoint, *args, **kwargs):
    """æ€§èƒ½ç›‘æ§åˆ‡é¢ - æ£€æµ‹æ…¢æ–¹æ³•(>100ms)"""

@Aspect(bind=True)
def exception_aspect(cutpoint, *args, **kwargs):
    """å¼‚å¸¸å¤„ç†åˆ‡é¢ - ç»Ÿä¸€å¼‚å¸¸è®°å½•"""

@Aspect(bind=True)
def transaction_aspect(cutpoint, *args, **kwargs):
    """äº‹åŠ¡ç®¡ç†åˆ‡é¢ - çŠ¶æ€å¤‡ä»½å’Œå›æ»š"""
```

#### **è£…é¥°å™¨API**
- `@logged` - æ—¥å¿—è®°å½•
- `@performance_monitored` - æ€§èƒ½ç›‘æ§  
- `@transactional` - äº‹åŠ¡ç®¡ç†
- `@monitored` - ç»¼åˆç›‘æ§(æ‰€æœ‰åˆ‡é¢)

### 3. äº‹ä»¶é©±åŠ¨æ¶æ„

#### **blinkeräº‹ä»¶ç³»ç»Ÿ**
```python
from engine.events import game_events

# äº‹ä»¶å‘å¸ƒ
game_events.emit('resource_gathered', worker, amount)
game_events.emit('unit_selected', unit_list)
game_events.emit('building_completed', building)

# äº‹ä»¶è®¢é˜…
@game_events.connect
def on_resource_gathered(sender, amount):
    # å¤„ç†èµ„æºé‡‡é›†äº‹ä»¶
```

#### **æ ¸å¿ƒäº‹ä»¶ç±»å‹**
- `resource_gathered` - èµ„æºé‡‡é›†å®Œæˆ
- `unit_selected` - å•ä½é€‰æ‹©å˜æ›´
- `building_completed` - å»ºç­‘å»ºé€ å®Œæˆ
- `unit_moved` - å•ä½ç§»åŠ¨å®Œæˆ
- `combat_occurred` - æˆ˜æ–—å‘ç”Ÿ

### 4. çŠ¶æ€æœºæ¶æ„

#### **transitionsé›†æˆ**
```python
class WorkerStateMachine(Machine):
    states = ['idle', 'moving', 'gathering', 'returning', 'unloading']
    
    transitions = [
        {'trigger': 'start_gather', 'source': '*', 'dest': 'moving'},
        {'trigger': 'reach_resource', 'source': 'moving', 'dest': 'gathering'},
        {'trigger': 'full_load', 'source': 'gathering', 'dest': 'returning'},
        {'trigger': 'reach_base', 'source': 'returning', 'dest': 'unloading'},
        {'trigger': 'unload_complete', 'source': 'unloading', 'dest': 'idle'}
    ]
```

#### **çŠ¶æ€æœºç‰¹æ€§**
- **è‡ªåŠ¨å¾ªç¯**: é‡‡é›†-å¸è½½-å†é‡‡é›†çš„è‡ªåŠ¨å¾ªç¯
- **çŠ¶æ€ä¸­æ–­**: æ”¯æŒçŠ¶æ€æœºä¸­æ–­å’Œé‡æ–°å¼€å§‹
- **äº‹ä»¶é›†æˆ**: çŠ¶æ€è½¬æ¢è‡ªåŠ¨å‘é€äº‹ä»¶
- **IoCç®¡ç†**: é€šè¿‡å®¹å™¨ç®¡ç†çŠ¶æ€æœºç”Ÿå‘½å‘¨æœŸ

### 5. ECS å®ä½“ç»„ä»¶ç³»ç»Ÿ

#### **esperé›†æˆ**
```python
# ç»„ä»¶å®šä¹‰
@dataclass
class PositionComponent:
    x: float
    y: float

@dataclass  
class HealthComponent:
    current: int
    maximum: int

@dataclass
class ResourceComponent:
    amount: int
    capacity: int

# ç³»ç»Ÿå®ç°
class MovementSystem(esper.Processor):
    def process(self, dt):
        for ent, (pos, vel) in self.world.get_components(
            PositionComponent, VelocityComponent):
            pos.x += vel.x * dt
            pos.y += vel.y * dt
```

#### **ECSç‰¹æ€§**
- **ç»„ä»¶åŒ–**: æ•°æ®ä¸é€»è¾‘åˆ†ç¦»çš„ç»„ä»¶è®¾è®¡
- **ç³»ç»ŸåŒ–**: ä¸“é—¨çš„Systemå¤„ç†ç‰¹å®šé€»è¾‘
- **æ€§èƒ½ä¼˜åŒ–**: esperæä¾›é«˜æ•ˆçš„ç»„ä»¶æŸ¥è¯¢
- **æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°ç»„ä»¶å’Œç³»ç»Ÿ

### 6. æ¸¸æˆå¼•æ“å±‚

#### **Pygameæ ¸å¿ƒ**
- **æ¸²æŸ“ç³»ç»Ÿ**: 60FPSå®æ—¶æ¸²æŸ“
- **äº‹ä»¶å¤„ç†**: ç”¨æˆ·è¾“å…¥å’Œæ¸¸æˆäº‹ä»¶
- **èµ„æºç®¡ç†**: å›¾ç‰‡ã€å£°éŸ³ã€å­—ä½“èµ„æº
- **ç¢°æ’æ£€æµ‹**: Pygameå†…ç½®ç¢°æ’æ£€æµ‹

#### **æ¸¸æˆå¯¹è±¡**
- **å•ä½ç³»ç»Ÿ**: UnitåŸºç±» + Workerå·¥äººå•ä½
- **å»ºç­‘ç³»ç»Ÿ**: BuildingåŸºç±» + CommandCenteræŒ‡æŒ¥ä¸­å¿ƒ  
- **åœ°å›¾ç³»ç»Ÿ**: Mapç±»ç®¡ç†åœ°å›¾å’Œèµ„æºç‚¹
- **æ¸¸æˆå¾ªç¯**: Gameç±»ç®¡ç†ä¸»å¾ªç¯å’ŒçŠ¶æ€

## ğŸ¯ æ¶æ„å®Œå–„åº¦è¯„ä¼°

### âœ… **å·²å®Œå–„ç»„ä»¶** (90%+)

| ç»„ä»¶ | å®Œå–„åº¦ | çŠ¶æ€ | è¯´æ˜ |
|------|--------|------|------|
| IoCå®¹å™¨ | 95% | âœ… å®Œæˆ | ä¸‰å±‚å®¹å™¨æ¶æ„ï¼Œ12ä¸ªæ ¸å¿ƒæœåŠ¡ |
| AOPåˆ‡é¢ | 90% | âœ… å®Œæˆ | å››å¤§åˆ‡é¢ï¼Œè£…é¥°å™¨API |
| äº‹ä»¶ç³»ç»Ÿ | 85% | âœ… å®Œæˆ | blinkeré›†æˆï¼Œæ ¸å¿ƒäº‹ä»¶å®šä¹‰ |
| çŠ¶æ€æœº | 90% | âœ… å®Œæˆ | transitionsé›†æˆï¼Œè‡ªåŠ¨å¾ªç¯ |
| ECSæ¶æ„ | 80% | âœ… å®Œæˆ | esperé›†æˆï¼Œç»„ä»¶ç³»ç»Ÿ |

### âš ï¸ **å¾…å®Œå–„ç»„ä»¶** (<50%)

| ç»„ä»¶ | å®Œå–„åº¦ | çŠ¶æ€ | å½±å“ |
|------|--------|------|------|
| ç‰©ç†ç¢°æ’ | 20% | ğŸš§ ç¼ºå¤± | Workeré‡å é—®é¢˜ |
| è·¯å¾„è§„åˆ’ | 10% | ğŸš§ ç¼ºå¤± | æ— æ™ºèƒ½é¿éšœ |
| ç½‘ç»œé€šä¿¡ | 0% | ğŸš§ ç¼ºå¤± | æ— MCPåè®®æ”¯æŒ |

### ğŸš€ **åç»­å¼€å‘ä¼˜å…ˆçº§**

1. **MCPæ¥å£è®¾è®¡** (é«˜ä¼˜å…ˆçº§)
   - ä¸ä¾èµ–ç‰©ç†ç¢°æ’å’Œå¯»è·¯
   - åŸºäºç°æœ‰æ¶æ„å³å¯å®ç°

2. **ç‰©ç†ç¢°æ’æ£€æµ‹** (ä¸­ä¼˜å…ˆçº§)  
   - pymunké›†æˆ
   - Workerä½ç½®å†²çªè§£å†³

3. **è·¯å¾„è§„åˆ’ç³»ç»Ÿ** (ä¸­ä¼˜å…ˆçº§)
   - pathfinding A*ç®—æ³•é›†æˆ
   - æ™ºèƒ½é¿éšœç®—æ³•

4. **ç½‘ç»œé€šä¿¡å±‚** (ä½ä¼˜å…ˆçº§)
   - websocketsé›†æˆ
   - å¤šäººæ¸¸æˆæ”¯æŒ

## ğŸ“Š æŠ€æœ¯é€‰å‹æ€»ç»“

### **ä¾èµ–åº“é€‰æ‹©**
- **dependency-injector**: ä¼ä¸šçº§IoCå®¹å™¨
- **aspectlib**: æˆç†Ÿçš„AOPæ¡†æ¶
- **blinker**: Flaskä½¿ç”¨çš„è½»é‡çº§äº‹ä»¶ç³»ç»Ÿ
- **transitions**: ä¸“ä¸šçŠ¶æ€æœºåº“
- **esper**: æ¸¸æˆä¼˜åŒ–çš„ECSåº“
- **pygame**: æˆç†Ÿçš„2Dæ¸¸æˆå¼•æ“

### **æ¶æ„ä¼˜åŠ¿**
1. **æ¨¡å—åŒ–**: æ¸…æ™°çš„å±‚æ¬¡åˆ†ç¦»å’ŒèŒè´£è¾¹ç•Œ
2. **å¯æµ‹è¯•**: IoCå’ŒAOPæä¾›å®Œå–„çš„æµ‹è¯•æ”¯æŒ
3. **å¯æ‰©å±•**: ECSæ¶æ„æ˜“äºæ·»åŠ æ–°åŠŸèƒ½
4. **é«˜æ€§èƒ½**: äº‹ä»¶é©±åŠ¨å‡å°‘è€¦åˆï¼Œæå‡æ€§èƒ½
5. **AIå‹å¥½**: ä¸ºAI Agentæ¥å…¥è®¾è®¡çš„æ¸…æ™°API

### **å¼€å‘æ•ˆç‡**
- **å¼€å‘å·¥å…·**: mypyã€pylintã€blackã€pytestå®Œæ•´å·¥å…·é“¾
- **CI/CD**: è‡ªåŠ¨åŒ–ç±»å‹æ£€æŸ¥å’Œä»£ç è´¨é‡éªŒè¯
- **æ–‡æ¡£åŒ–**: å®Œæ•´çš„æ¶æ„æ–‡æ¡£å’ŒAPIæ–‡æ¡£
- **è°ƒè¯•æ”¯æŒ**: AOPæ—¥å¿—åˆ‡é¢æä¾›å®Œæ•´çš„è°ƒç”¨è·Ÿè¸ª

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-11-03  
**çŠ¶æ€**: æ ¸å¿ƒæ¶æ„å®Œæˆï¼Œé€‚åˆç»§ç»­MCPæ¥å£å¼€å‘